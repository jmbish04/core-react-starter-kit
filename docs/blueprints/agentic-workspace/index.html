<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Agentic Workspace Architecture | Research Blueprint</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
    <style>
        /* Custom Styles & Overrides */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f5f5f4; /* Stone 100 */
            color: #1c1917; /* Stone 900 */
        }
        h1, h2, h3, .mono-font {
            font-family: 'JetBrains Mono', monospace;
        }
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
            height: 300px;
            max-height: 400px;
        }
        @media (min-width: 768px) {
            .chart-container {
                height: 350px;
            }
        }
        /* Architecture Block Styles */
        .arch-block {
            transition: all 0.2s ease-in-out;
            cursor: pointer;
        }
        .arch-block:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }
        .arch-block.active {
            border-color: #0f766e; /* Teal 700 */
            background-color: #f0fdfa; /* Teal 50 */
            box-shadow: 0 0 0 2px #0f766e;
        }
        /* Simulation Step Animation */
        .sim-step {
            opacity: 0;
            transform: translateY(10px);
            transition: opacity 0.5s ease, transform 0.5s ease;
        }
        .sim-step.visible {
            opacity: 1;
            transform: translateY(0);
        }
        /* Hide scrollbar for clean horizontal scroll */
        .no-scrollbar::-webkit-scrollbar {
            display: none;
        }
        .no-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
    </style>
</head>
<body class="bg-stone-100 text-stone-800 antialiased selection:bg-teal-200 selection:text-teal-900">

    <!-- REQUIRED PLACEHOLDERS -->
    <!-- Chosen Palette: Warm Neutrals (Stone/Zinc) with Teal/Cyan technical accents. Professional, clean, architectural. -->
    <!-- Application Structure Plan: 
         1. Header: Mission statement & role definition.
         2. Interactive Architecture Map (Top): A visual clickable grid representing the Stack (Frontend vs Backend). This anchors the user in the system design immediately.
         3. Simulation Console (Middle): Allows the user to 'run' a workflow (e.g. Draft Email) to see the logic flow described in the prompt.
         4. Deep Research Modules (Bottom): Tabbed interface for specific domains (Gmail, Drive, Editors) to avoid text overload.
         5. Feasibility Analysis (Sidebar/integrated): Chart.js comparison of approaches.
         Why? The prompt is a technical blueprint. The best way to understand an architecture is to interact with its diagram and simulate its processes.
    -->
    <!-- Visualization & Content Choices:
         1. Architecture Map: HTML/Tailwind Grid. No SVG. Interactive blocks display details on click. Goal: Spatial understanding of the stack.
         2. Radar Chart: Chart.js. Compares 'Standard Apps Script' vs 'Agentic Cloudflare' on Latency, Power, Complexity. Goal: Justify the architecture.
         3. Workflow Simulator: JS-driven list generation with delays. Goal: Visualize the async nature of Queues/Workflows described in the prompt.
         4. Tabbed Content: Standard HTML/JS. Goal: Organize dense research questions per app (Gmail/Drive/Docs).
         CONFIRMATION: NO SVG graphics used. NO Mermaid JS used.
    -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->

    <!-- Main Container -->
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 space-y-8">

        <!-- Header Section -->
        <header class="bg-white border-l-4 border-teal-600 shadow-sm rounded-r-lg p-6">
            <div class="flex flex-col md:flex-row justify-between items-start md:items-center">
                <div>
                    <h1 class="text-2xl md:text-3xl font-bold text-stone-900 mb-2">Agentic Workspace Blueprint</h1>
                    <p class="text-stone-600 text-sm md:text-base max-w-2xl">
                        Technical specification for a hybrid architecture: <strong>Cloudflare Workers</strong> (Backend Brain) + <strong>Google Apps Script</strong> (Frontend Interface).
                        Designed to enable autonomous agents within Gmail, Drive, and Editors.
                    </p>
                </div>
                <div class="mt-4 md:mt-0 px-4 py-2 bg-stone-100 rounded text-xs font-mono text-stone-500">
                    Role: Principal Architect<br>
                    Status: Research Phase
                </div>
            </div>
        </header>

        <!-- Top Row: Architecture & Feasibility -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            
            <!-- Interactive Architecture Map (2/3 width) -->
            <section class="lg:col-span-2 bg-white rounded-xl shadow-sm border border-stone-200 overflow-hidden flex flex-col">
                <div class="p-5 border-b border-stone-100">
                    <h2 class="text-lg font-bold flex items-center gap-2">
                        <span class="w-3 h-3 rounded-full bg-teal-500"></span>
                        System Architecture Map
                    </h2>
                    <p class="text-xs text-stone-500 mt-1">Click a component to reveal specification details.</p>
                </div>

                <!-- The Map (CSS Grid) -->
                <div class="p-6 bg-stone-50 flex-grow flex flex-col justify-center">
                    <!-- Layer Labels -->
                    <div class="flex justify-between text-xs font-mono text-stone-400 mb-2 px-2">
                        <span>USER LAYER (Google)</span>
                        <span>BRIDGE</span>
                        <span>COMPUTE LAYER (Cloudflare)</span>
                        <span>DATA LAYER</span>
                    </div>

                    <!-- Diagram Container -->
                    <div class="grid grid-cols-4 gap-4 relative">
                        <!-- Connecting "Lines" (Simulated with borders/positioning) -->
                        <div class="absolute top-1/2 left-0 w-full h-1 bg-stone-200 -z-0"></div>

                        <!-- Node 1: Apps Script -->
                        <div onclick="selectArch('frontend')" id="node-frontend" class="arch-block relative z-10 bg-white border-2 border-blue-200 p-4 rounded-lg text-center h-32 flex flex-col items-center justify-center hover:border-blue-400">
                            <span class="text-2xl mb-2">‚ö°</span>
                            <span class="font-bold text-sm text-stone-800">Apps Script</span>
                            <span class="text-[10px] text-stone-500">CardService UI</span>
                        </div>

                        <!-- Node 2: Auth Bridge -->
                        <div onclick="selectArch('auth')" id="node-auth" class="arch-block relative z-10 bg-white border-2 border-orange-200 p-4 rounded-lg text-center h-32 flex flex-col items-center justify-center hover:border-orange-400">
                            <span class="text-2xl mb-2">üîê</span>
                            <span class="font-bold text-sm text-stone-800">Auth Bridge</span>
                            <span class="text-[10px] text-stone-500">OAuth2 / Service Acct</span>
                        </div>

                        <!-- Node 3: Worker / Agents -->
                        <div onclick="selectArch('worker')" id="node-worker" class="arch-block relative z-10 bg-white border-2 border-teal-200 p-4 rounded-lg text-center h-32 flex flex-col items-center justify-center hover:border-teal-400">
                            <span class="text-2xl mb-2">‚öôÔ∏è</span>
                            <span class="font-bold text-sm text-stone-800">CF Workers</span>
                            <span class="text-[10px] text-stone-500">Agents SDK / Queues</span>
                        </div>

                        <!-- Node 4: Storage -->
                        <div onclick="selectArch('storage')" id="node-storage" class="arch-block relative z-10 bg-white border-2 border-indigo-200 p-4 rounded-lg text-center h-32 flex flex-col items-center justify-center hover:border-indigo-400">
                            <span class="text-2xl mb-2">üíæ</span>
                            <span class="font-bold text-sm text-stone-800">D1 & Vectorize</span>
                            <span class="text-[10px] text-stone-500">State & Embeddings</span>
                        </div>
                    </div>
                </div>

                <!-- Detail Panel -->
                <div class="bg-stone-100 p-5 border-t border-stone-200 min-h-[140px]">
                    <h3 id="detail-title" class="font-bold text-stone-800 text-sm mb-2">Select a component above...</h3>
                    <p id="detail-desc" class="text-sm text-stone-600 leading-relaxed">Interact with the architecture map to understand the specific role of each component in the Agentic Workspace.</p>
                </div>
            </section>

            <!-- Feasibility Radar Chart (1/3 width) -->
            <section class="lg:col-span-1 bg-white rounded-xl shadow-sm border border-stone-200 p-5 flex flex-col">
                <h2 class="text-lg font-bold mb-1">Stack Comparison</h2>
                <p class="text-xs text-stone-500 mb-4">Native Apps Script vs. Cloudflare Agentic</p>
                <div class="flex-grow flex items-center justify-center">
                    <div class="chart-container">
                        <canvas id="feasibilityChart"></canvas>
                    </div>
                </div>
                <div class="mt-4 text-xs text-center text-stone-400 italic">
                    Based on API limits and architectural capability.
                </div>
            </section>
        </div>

        <!-- Middle Row: Interactive Simulation -->
        <section class="bg-white rounded-xl shadow-sm border border-stone-200 overflow-hidden">
            <div class="p-6 border-b border-stone-100 bg-stone-50">
                <div class="flex flex-col md:flex-row justify-between items-center gap-4">
                    <div>
                        <h2 class="text-lg font-bold text-stone-800">Workflow Simulator</h2>
                        <p class="text-sm text-stone-600 mt-1">Visualize the async data flow between Google Workspace and Cloudflare.</p>
                    </div>
                    <div class="flex gap-2">
                        <select id="sim-selector" class="bg-white border border-stone-300 text-stone-700 text-sm rounded-lg focus:ring-teal-500 focus:border-teal-500 block p-2.5">
                            <option value="draft">Simulate: Context-Aware Email Draft</option>
                            <option value="index">Simulate: Drive Knowledge Indexing</option>
                        </select>
                        <button onclick="runSimulation()" class="text-white bg-teal-700 hover:bg-teal-800 focus:ring-4 focus:ring-teal-300 font-medium rounded-lg text-sm px-5 py-2.5 focus:outline-none">
                            Execute Agent
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- Terminal Output Area -->
            <div class="p-6 bg-stone-900 text-teal-400 font-mono text-xs md:text-sm h-64 overflow-y-auto rounded-b-xl shadow-inner relative" id="console-output">
                <div class="absolute top-4 right-4 text-stone-600 select-none">CONSOLE_OUT</div>
                <div id="sim-logs" class="space-y-2">
                    <p class="text-stone-500">// System ready. Waiting for trigger...</p>
                </div>
            </div>
        </section>

        <!-- Bottom Row: Deep Research Modules (Tabs) -->
        <section class="bg-white rounded-xl shadow-sm border border-stone-200">
            <div class="p-6 border-b border-stone-100">
                <h2 class="text-xl font-bold text-stone-800">Domain Specific Research</h2>
                <p class="text-stone-600 mt-2">Deep dive into specific implementation strategies for each Workspace application.</p>
            </div>

            <!-- Tab Navigation -->
            <div class="border-b border-stone-200">
                <nav class="flex -mb-px px-6 overflow-x-auto no-scrollbar" aria-label="Tabs">
                    <button onclick="switchTab('gmail')" id="tab-gmail" class="tab-btn active border-teal-500 text-teal-600 whitespace-nowrap py-4 px-4 border-b-2 font-medium text-sm">
                        Gmail: Drafting
                    </button>
                    <button onclick="switchTab('drive')" id="tab-drive" class="tab-btn border-transparent text-stone-500 hover:text-stone-700 hover:border-stone-300 whitespace-nowrap py-4 px-4 border-b-2 font-medium text-sm">
                        Drive: Knowledge Base
                    </button>
                    <button onclick="switchTab('editors')" id="tab-editors" class="tab-btn border-transparent text-stone-500 hover:text-stone-700 hover:border-stone-300 whitespace-nowrap py-4 px-4 border-b-2 font-medium text-sm">
                        Editors: Collaboration
                    </button>
                    <button onclick="switchTab('security')" id="tab-security" class="tab-btn border-transparent text-stone-500 hover:text-stone-700 hover:border-stone-300 whitespace-nowrap py-4 px-4 border-b-2 font-medium text-sm">
                        Security & Privacy
                    </button>
                </nav>
            </div>

            <!-- Tab Content -->
            <div class="p-6 bg-stone-50 min-h-[300px]">
                
                <!-- Gmail Content -->
                <div id="content-gmail" class="tab-content block animate-fade-in">
                    <div class="grid md:grid-cols-2 gap-8">
                        <div>
                            <h3 class="text-teal-800 font-bold mb-3">Context-Aware Drafting</h3>
                            <ul class="space-y-3 text-sm text-stone-700">
                                <li class="flex items-start gap-2">
                                    <span class="text-teal-500 font-bold">1.</span>
                                    <span><strong>Holistic Context Window:</strong> Do not rely on just the current thread. Worker queries `Vectorize` for "all past emails from sender" + "related Drive docs" before prompting the LLM.</span>
                                </li>
                                <li class="flex items-start gap-2">
                                    <span class="text-teal-500 font-bold">2.</span>
                                    <span><strong>Tone Mimicry:</strong> Store user's `Sent` history in Vectorize. Retrieve top 5 semantically similar sent emails to use as "few-shot" examples for style.</span>
                                </li>
                                <li class="flex items-start gap-2">
                                    <span class="text-teal-500 font-bold">3.</span>
                                    <span><strong>Draft Injection:</strong> Use `Users.messages.drafts.create` API. The Add-on UI acts as a "Tuner" (Formal <-> Direct slider) which triggers a re-generation via the Worker.</span>
                                </li>
                            </ul>
                        </div>
                        <div class="bg-white p-4 rounded-lg border border-stone-200 shadow-sm">
                            <h4 class="font-mono text-xs font-bold text-stone-400 mb-2">UX PATTERN: THE TUNER</h4>
                            <div class="space-y-4">
                                <div class="h-2 bg-stone-100 rounded overflow-hidden">
                                    <div class="w-3/4 h-full bg-teal-400"></div>
                                </div>
                                <div class="flex justify-between text-xs font-bold text-stone-500">
                                    <span>Concise</span>
                                    <span>Verbose</span>
                                </div>
                                <div class="p-3 bg-stone-50 text-xs text-stone-600 italic border-l-2 border-teal-500">
                                    "User adjusts slider in Apps Script sidebar -> Worker receives parameter -> LLM re-prompts with style instruction -> Draft updated."
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Drive Content -->
                <div id="content-drive" class="tab-content hidden">
                    <div class="grid md:grid-cols-2 gap-8">
                        <div>
                            <h3 class="text-teal-800 font-bold mb-3">Indexing & RAG Strategy</h3>
                            <ul class="space-y-3 text-sm text-stone-700">
                                <li class="flex items-start gap-2">
                                    <span class="text-teal-500 font-bold">1.</span>
                                    <span><strong>Selective Indexing:</strong> A "Worker Frontend" dashboard allows users to pick specific Folders to watch. Full drive indexing is too expensive/noisy.</span>
                                </li>
                                <li class="flex items-start gap-2">
                                    <span class="text-teal-500 font-bold">2.</span>
                                    <span><strong>Async Queues:</strong> Indexing is a long-running task. Apps Script triggers a job -> Cloudflare Queue accepts it -> Durable Object manages the pagination state of `Drive.Files.list`.</span>
                                </li>
                                <li class="flex items-start gap-2">
                                    <span class="text-teal-500 font-bold">3.</span>
                                    <span><strong>Cross-Pollination:</strong> Bridge Drive data into Gmail agents. "Draft reply using the 'Pricing PDF' in folder X".</span>
                                </li>
                            </ul>
                        </div>
                        <div class="bg-white p-4 rounded-lg border border-stone-200 shadow-sm">
                            <h4 class="font-mono text-xs font-bold text-stone-400 mb-2">ARCHITECTURE: THE QUEUE LOOP</h4>
                            <div class="flex flex-col gap-2">
                                <div class="p-2 bg-stone-50 border border-stone-200 rounded text-xs text-center">User Selects Folder (UI)</div>
                                <div class="text-center text-stone-300">‚¨áÔ∏è</div>
                                <div class="p-2 bg-stone-50 border border-stone-200 rounded text-xs text-center">CF Queue: "Index_Folder_123"</div>
                                <div class="text-center text-stone-300">‚¨áÔ∏è</div>
                                <div class="p-2 bg-teal-50 border border-teal-200 rounded text-xs text-center font-bold text-teal-800">Consumer (Worker) splits PDF pages</div>
                                <div class="text-center text-stone-300">‚¨áÔ∏è</div>
                                <div class="p-2 bg-indigo-50 border border-indigo-200 rounded text-xs text-center font-bold text-indigo-800">Vectorize: Store Embeddings</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Editors Content -->
                <div id="content-editors" class="tab-content hidden">
                    <div class="grid md:grid-cols-2 gap-8">
                        <div>
                            <h3 class="text-teal-800 font-bold mb-3">Docs, Sheets & Slides</h3>
                            <ul class="space-y-3 text-sm text-stone-700">
                                <li class="flex items-start gap-2">
                                    <span class="text-teal-500 font-bold">1.</span>
                                    <span><strong>The "Alert" Problem:</strong> Use a `Cron` trigger in Cloudflare to poll `comments.list` API periodically, or a manual "Scan" button in the Add-on. Webhooks for Drive comments are limited.</span>
                                </li>
                                <li class="flex items-start gap-2">
                                    <span class="text-teal-500 font-bold">2.</span>
                                    <span><strong>Rich Responses:</strong> Agents should use `suggestedData` in the API to propose edits rather than overwriting user text directly. Safer UX.</span>
                                </li>
                                <li class="flex items-start gap-2">
                                    <span class="text-teal-500 font-bold">3.</span>
                                    <span><strong>Generative Actions:</strong> Use Cloudflare Workers AI to generate JSON structures for Sheets (batchUpdate) or Slides styling themes.</span>
                                </li>
                            </ul>
                        </div>
                         <div class="bg-white p-4 rounded-lg border border-stone-200 shadow-sm">
                            <h4 class="font-mono text-xs font-bold text-stone-400 mb-2">REGEX AGENT SCANNER</h4>
                            <div class="p-3 bg-stone-900 text-teal-400 font-mono text-xs rounded">
                                > Scanning Doc ID: 1x7...9<br>
                                > Found comment: "@agent fix grammar"<br>
                                > Context: "The quick brown fox..."<br>
                                > Action: Suggestion.InsertText<br>
                                > Status: PENDING USER APPROVAL
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Security Content -->
                <div id="content-security" class="tab-content hidden">
                    <div class="grid md:grid-cols-2 gap-8">
                        <div>
                            <h3 class="text-teal-800 font-bold mb-3">Security & Multi-Tenancy</h3>
                            <ul class="space-y-3 text-sm text-stone-700">
                                <li class="flex items-start gap-2">
                                    <span class="text-teal-500 font-bold">1.</span>
                                    <span><strong>Data Residency:</strong> Strict logical separation in D1. Use `user_id` as the partition key for all queries. One Durable Object per User (or per Organization) ensures memory isolation.</span>
                                </li>
                                <li class="flex items-start gap-2">
                                    <span class="text-teal-500 font-bold">2.</span>
                                    <span><strong>Secrets Management:</strong> Store Google Refresh Tokens in Cloudflare Encrypted KV or Secrets. Never expose tokens to the client-side Apps Script beyond the initial auth flow.</span>
                                </li>
                                <li class="flex items-start gap-2">
                                    <span class="text-teal-500 font-bold">3.</span>
                                    <span><strong>Auth Bridge:</strong> Use `SignInWithGoogle` on the Worker side to get a Refresh Token. Pass a session token to the Apps Script Add-on.</span>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>

            </div>
        </section>

    </div>

    <!-- JavaScript Logic -->
    <script>
        // --- State Management ---
        const appState = {
            currentTab: 'gmail',
            simulationRunning: false,
            selectedArchNode: null
        };

        // --- Data: Architecture Details ---
        const archDetails = {
            frontend: {
                title: "Frontend: Google Apps Script (CardService)",
                desc: "Acts strictly as a 'View' layer. It captures context (Email ID, Doc ID) and renders Cards based on JSON payloads from the Worker. Minimal logic resides here to avoid the 6-minute execution limit."
            },
            auth: {
                title: "Auth Bridge: OAuth2 & Service Accounts",
                desc: "Securely passes credentials. Uses a User-centric OAuth flow to grant the Worker 'offline' access (Refresh Token) so agents can work in the background (e.g., indexing) without the browser open."
            },
            worker: {
                title: "Backend: Cloudflare Workers & Agents SDK",
                desc: "The 'Brain'. Handles complex logic, LLM calls (Workers AI), and orchestrates workflows. Uses Queues for long-running tasks like 'Index Shared Drive' to bypass HTTP timeout limits."
            },
            storage: {
                title: "Data: D1 (SQL) & Vectorize",
                desc: "D1 stores structured state (User prefs, Task logs). Vectorize stores semantic embeddings of emails and docs for RAG. Data is partitioned by User ID for strict multi-tenancy."
            }
        };

        // --- Interaction: Architecture Map ---
        function selectArch(nodeId) {
            // Remove active class from all
            document.querySelectorAll('.arch-block').forEach(el => {
                el.classList.remove('active');
                el.classList.remove('bg-teal-50');
            });
            
            // Add active to selected
            const selected = document.getElementById(`node-${nodeId}`);
            selected.classList.add('active');

            // Update Details
            const info = archDetails[nodeId];
            const titleEl = document.getElementById('detail-title');
            const descEl = document.getElementById('detail-desc');

            titleEl.textContent = info.title;
            descEl.textContent = info.desc;
            
            // Animation reset
            titleEl.classList.remove('animate-fade-in');
            void titleEl.offsetWidth; // trigger reflow
            titleEl.classList.add('animate-fade-in');
        }

        // --- Interaction: Tabs ---
        function switchTab(tabId) {
            // Update buttons
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active', 'border-teal-500', 'text-teal-600');
                btn.classList.add('border-transparent', 'text-stone-500');
            });
            const activeBtn = document.getElementById(`tab-${tabId}`);
            activeBtn.classList.remove('border-transparent', 'text-stone-500');
            activeBtn.classList.add('active', 'border-teal-500', 'text-teal-600');

            // Update content
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.add('hidden');
            });
            document.getElementById(`content-${tabId}`).classList.remove('hidden');
        }

        // --- Interaction: Simulation ---
        async function runSimulation() {
            if (appState.simulationRunning) return;
            appState.simulationRunning = true;

            const type = document.getElementById('sim-selector').value;
            const consoleEl = document.getElementById('sim-logs');
            consoleEl.innerHTML = ''; // Clear logs

            const logs = type === 'draft' ? [
                { text: "> User opens email. Add-on fetching context...", delay: 500 },
                { text: "> Apps Script sends Thread ID to CF Worker...", delay: 1000 },
                { text: "> Worker querying Vectorize for 'Related Docs'...", delay: 1800 },
                { text: "> Found 3 relevant PDFs in D1 Index.", delay: 2400 },
                { text: "> Retrieving User Tone from 'Sent' history...", delay: 3000 },
                { text: "> Sending Prompt to LLM (Context + Tone)...", delay: 3800 },
                { text: "> Generated Draft. Returning JSON to CardService.", delay: 4800 },
                { text: "<span class='text-white bg-teal-600 px-1'>SUCCESS</span> Draft inserted in sidebar.", delay: 5000 }
            ] : [
                { text: "> User selects 'Project X' Folder to Index.", delay: 500 },
                { text: "> Apps Script sends Folder ID to Worker.", delay: 1000 },
                { text: "> Worker pushes Job to CF Queue: 'Index_Folder_X'", delay: 1500 },
                { text: "> <span class='text-yellow-500'>ASYNC</span> Consumer picked up job.", delay: 2200 },
                { text: "> Listing files (pagination handled by Durable Object)...", delay: 3000 },
                { text: "> Processing file 1/50: 'Specs.pdf'", delay: 3800 },
                { text: "> Generating Embeddings via Workers AI...", delay: 4500 },
                { text: "> Vectorize Index Updated.", delay: 5200 },
                { text: "<span class='text-white bg-teal-600 px-1'>DONE</span> Folder indexed in background.", delay: 5500 }
            ];

            // Execute logs
            for (let log of logs) {
                await new Promise(r => setTimeout(r, log.delay - (logs[logs.indexOf(log)-1]?.delay || 0)));
                const p = document.createElement('div');
                p.className = "sim-step font-mono border-l-2 border-stone-700 pl-2";
                p.innerHTML = log.text;
                consoleEl.appendChild(p);
                // Trigger reflow for animation
                requestAnimationFrame(() => p.classList.add('visible'));
                // Auto scroll
                document.getElementById('console-output').scrollTop = document.getElementById('console-output').scrollHeight;
            }

            appState.simulationRunning = false;
        }

        // --- Chart.js Initialization ---
        document.addEventListener('DOMContentLoaded', () => {
            const ctx = document.getElementById('feasibilityChart').getContext('2d');
            new Chart(ctx, {
                type: 'radar',
                data: {
                    labels: ['Context Window', 'Execution Time', 'State Persistence', 'Cost Efficiency', 'Dev Complexity', 'Latency'],
                    datasets: [{
                        label: 'Cloudflare Agentic',
                        data: [90, 95, 100, 85, 40, 80], // High capability, higher complexity
                        fill: true,
                        backgroundColor: 'rgba(20, 184, 166, 0.2)', // Teal
                        borderColor: 'rgb(20, 184, 166)',
                        pointBackgroundColor: 'rgb(20, 184, 166)',
                        pointBorderColor: '#fff',
                        pointHoverBackgroundColor: '#fff',
                        pointHoverBorderColor: 'rgb(20, 184, 166)'
                    }, {
                        label: 'Native Apps Script',
                        data: [30, 20, 40, 90, 90, 60], // Low capability, easy dev
                        fill: true,
                        backgroundColor: 'rgba(120, 113, 108, 0.2)', // Stone
                        borderColor: 'rgb(120, 113, 108)',
                        pointBackgroundColor: 'rgb(120, 113, 108)',
                        pointBorderColor: '#fff',
                        pointHoverBackgroundColor: '#fff',
                        pointHoverBorderColor: 'rgb(120, 113, 108)'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    elements: {
                        line: { borderWidth: 2 }
                    },
                    scales: {
                        r: {
                            angleLines: { color: '#e7e5e4' },
                            grid: { color: '#e7e5e4' },
                            pointLabels: {
                                font: { size: 10, family: 'Inter' },
                                color: '#57534e'
                            },
                            ticks: { display: false, backdropColor: 'transparent' }
                        }
                    },
                    plugins: {
                        legend: { position: 'top', labels: { font: { family: 'Inter' }, usePointStyle: true } },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return context.dataset.label + ': ' + context.raw + '% Capability';
                                }
                            }
                        }
                    }
                }
            });

            // Initialize Architecture
            selectArch('worker');
        });
    </script>
</body>
</html>
